
version: "3.3"
services:

  reverse-proxy:
    image: nginx:1.17
    container_name: reverse_proxy
    depends_on:
      - streamlit-app
      - dateideas-api
    ports:
      - "80:80"
    volumes:
      - type: bind
        source: ./reverse_proxy/nginx.conf
        target: /etc/nginx/nginx.conf
    networks:
      - nginx-network

  streamlit-app:
    image: continuumio/miniconda3
    container_name: streamlit_app
    command: bash -c "pip install streamlit 
                      && streamlit run app/streamlit_app.py  --server.port 8080" # --server.address=localhost
    ports: 
      - "8080:8080"
    volumes: 
     - type: bind
       source: ./streamlit_app
       target: /app
    networks:
      - nginx-network
    restart: on-failure
  
  dateideas-api:
    image: node:slim
    build: 
      context: ./http_api
      dockerfile: ../http_api.Dockerfile
    container_name: dateideas_api
    command: bash -c "node app/app.js"
    ports:
      - "3000:3000" ## remove in the future
    volumes: 
     - type: bind
       source: ./http_api
       target: /app
    networks:
      - nginx-network
    restart: on-failure
    env_file:
      - ./http_api/.env
networks:
  nginx-network:
    driver: bridge
